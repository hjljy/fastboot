<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.hjljy.fastboot.mapper.member.MemberBaseInfoMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="cn.hjljy.fastboot.pojo.member.po.MemberBaseInfo">
        <id column="member_id" property="memberId"/>
        <result column="org_id" property="orgId"/>
        <result column="member_sex" property="memberSex"/>
        <result column="member_name" property="memberName"/>
        <result column="member_phone" property="memberPhone"/>
        <result column="member_birth" property="memberBirth"/>
        <result column="level_id" property="levelId"/>
        <result column="balance" property="balance"/>
        <result column="gen_balance" property="genBalance"/>
        <result column="member_card" property="memberCard"/>
        <result column="member_Integral" property="memberIntegral"/>
        <result column="growth_value" property="growthValue"/>
        <result column="remark" property="remark"/>
        <result column="create_time" property="createTime"/>
        <result column="create_user" property="createUser"/>
        <result column="source" property="source"/>
        <result column="update_time" property="updateTime"/>
        <result column="status" property="status"/>
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        member_id
        , org_id, member_sex, member_name,source, member_phone, member_birth, level_id, balance, gen_balance, member_card,
        member_Integral, growth_value, remark, create_time, create_user, update_time, status
    </sql>
    <select id="getMemberBaseInfoPageList" resultType="cn.hjljy.fastboot.pojo.member.dto.MemberBaseInfoDto">
        select
        m.member_id,
        m.org_id,
        m.member_card,
        m.member_name,
        m.member_phone,
        m.member_birth,
        m.level_id,
        m.balance,
        m.gen_balance,
        m.member_Integral,
        m.growth_value,
        m.remark,
        m.source,
        m.create_time,
        m.create_user,
        m.update_time,
        ml.level_name
        from member_base_info m
        left join member_level ml on m.level_id = ml.level_id
        where m.org_id=#{orgId} and m.status = 0 and ml.status = 0
        <if test="levelId !=null">
            and m.level_id =#{levelId}
        </if>
        <if test="keywords !=null and keywords !=''">
            and m.member_name like CONCAT("%",#{keywords},"%")
            or m.member_phone like CONCAT("%",#{keywords},"%")
        </if>

    </select>

</mapper>
